<section class="waitlist-card" id="waitlist">
  <h3>Join the waitlist</h3>
  <p class="hint"><span aria-hidden="true">*</span> indicates a required field</p>

  <form id="waitlist-form" novalidate>
    <div class="form-grid">
      <div class="field">
        <label for="first">First Name <span aria-hidden="true">*</span></label>
        <input id="first" name="first" required />
      </div>
      <div class="field">
        <label for="last">Last Name</label>
        <input id="last" name="last" />
      </div>
    </div>

    <div class="field">
      <label for="email">Email <span aria-hidden="true">*</span></label>
      <input type="email" id="email" name="email" required />
    </div>

    <!-- Honeypot -->
    <input type="text" name="company" tabindex="-1" autocomplete="off" class="hp" />

    <div class="actions">
      <button type="submit" id="waitlist-btn">Join waitlist</button>
    </div>

    <p id="waitlist-msg" role="status" aria-live="polite"></p>
  </form>
</section>

<style>
  :root{
    --card-bg:#fff; --border:#e5e7eb; --text:#111; --muted:#6b7280;
    --focus:#111; --radius:12px; --shadow:0 6px 30px rgba(0,0,0,.06);
  }
  .waitlist-card{max-width:640px;margin:48px auto;padding:32px;background:var(--card-bg);
    border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);}
  .waitlist-card h3{margin:0 0 8px;font-size:24px;line-height:1.2}
  .waitlist-card .hint{margin:0 0 24px;color:var(--muted);font-size:14px}
  .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width:720px){.form-grid{grid-template-columns:1fr}}
  .field{display:grid;gap:8px;margin:0 0 16px}
  .field label{font-weight:600}
  .field input{padding:14px 12px;border:1px solid var(--border);border-radius:10px;font-size:16px;outline:0}
  .field input:focus{border-color:var(--focus);box-shadow:0 0 0 3px rgba(17,17,17,.08)}
  .actions{margin-top:4px}
  button{background:#111;color:#fff;border:0;padding:12px 16px;border-radius:10px;font-weight:600}
  button[disabled]{opacity:.6;cursor:not-allowed}
  #waitlist-msg{margin-top:12px;font-size:14px;color:var(--muted)}
  .hp{position:absolute;left:-5000px}
</style>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

  // ðŸ”§ Replace with your project values
  const SUPABASE_URL  = "https://YOUR-PROJECT.supabase.co";
  const SUPABASE_ANON = "YOUR-ANON-KEY";

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

  const form = document.getElementById("waitlist-form");
  const btn  = document.getElementById("waitlist-btn");
  const msg  = document.getElementById("waitlist-msg");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const fd = new FormData(form);
    if (fd.get("company")) return; // honeypot

    const email = String(fd.get("email")||"").trim().toLowerCase();
    const first = String(fd.get("first")||"").trim();
    const last  = String(fd.get("last")||"").trim();

    if (!/^\S+@\S+\.\S+$/.test(email)) {
      msg.textContent = "Please enter a valid email."; return;
    }

    btn.disabled = true; btn.textContent = "Addingâ€¦"; msg.textContent = "";

    const p = new URLSearchParams(location.search);
    const { error } = await supabase.from("waitlist").insert([{
      email,
      name: [first,last].filter(Boolean).join(" "),
      source: location.hostname || "landing",
      utm_source:  p.get("utm_source"),
      utm_medium:  p.get("utm_medium"),
      utm_campaign:p.get("utm_campaign"),
    }]);

    if (!error)        { msg.textContent = "ðŸŽ‰ You're on the list!"; form.reset(); }
    else if (error.code === "23505") { msg.textContent = "You're already on the list â€” welcome back!"; }
    else { console.error(error); msg.textContent = "Something went wrong. Please try again."; }

    btn.disabled = false; btn.textContent = "Join waitlist";
  });
</script>
